<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkinStatz | Professional CS2 Trading Tracker</title>
    
    <!-- Favicon and PWA Meta -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3Eüìä%3C/text%3E%3C/svg%3E">
    <meta name="theme-color" content="#1f2937">
    <meta name="description" content="SkinStatz - Professional CS2 skin trading dashboard with advanced analytics, portfolio management, and market insights.">
    
    <!-- External Dependencies (Keep existing) -->
    <script src="apexcharts.min.js"></script>
    <script src="chart.min.js"></script>
    <script src="xlsx.full.min.js"></script>
    <script src="lucide.js"></script>
    <!-- <script src="index.min.js"></script> Commented out - causing exports error -->
    <script src="notyf.min.js"></script>
    <script src="Sortable.min.js"></script>
    
    <!-- Stylesheets -->
    <link href="tailwind.min.css" rel="stylesheet">
    <link href="animate.min.css" rel="stylesheet">
    <link href="notyf.min.css" rel="stylesheet">
    <link href="tracker.css" rel="stylesheet">
    
    <!-- Modern Dependencies - All Local Files -->
    <script src="zustand-local.js"></script>
    <script src="page.js"></script>
    <script src="cdn.min.js" defer></script>
    
    <!-- Custom Styles for Modular Interface -->
    <style>
        /* Modern Navigation Styles */
        .nav-sidebar {
            background: linear-gradient(180deg, rgba(15, 23, 42, 0.98) 0%, rgba(30, 41, 59, 0.95) 100%);
            backdrop-filter: blur(16px);
            border-right: 1px solid rgba(59, 130, 246, 0.1);
            box-shadow: 4px 0 24px rgba(0, 0, 0, 0.1);
        }
        
        .nav-item {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 3px solid transparent;
            position: relative;
            border-radius: 0 12px 12px 0;
            margin: 2px 8px 2px 0;
        }
        
        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.08), rgba(147, 51, 234, 0.05));
            border-radius: inherit;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .nav-item:hover::before {
            opacity: 1;
        }
        
        .nav-item:hover {
            background: transparent;
            border-left-color: rgba(59, 130, 246, 0.6);
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }
        
        .nav-item.active {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(147, 51, 234, 0.1));
            border-left-color: #3b82f6;
            color: #60a5fa;
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.2);
        }
        
        .nav-item.active .nav-icon {
            color: #60a5fa;
        }
        
        .nav-item .nav-icon {
            transition: all 0.3s ease;
        }
        
        .nav-item:hover .nav-icon {
            color: #93c5fd;
            transform: scale(1.1);
        }
        
        /* Loading States */
        .loading {
            position: relative;
            overflow: hidden;
        }
        
        .loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #3b82f6, transparent);
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        /* Page Transitions */
        .page-content {
            min-height: calc(100vh - 120px);
        }
        
        .page-content.active {
            animation: fadeInUp 0.3s ease-out;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .nav-sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .nav-sidebar.open {
                transform: translateX(0);
            }
        }
        
        /* CS2 Theme Colors */
        .cs2-primary { color: #ff6b35; }
        .cs2-secondary { color: #004e89; }
        .cs2-accent { color: #ffa400; }
        
        /* Modern glassmorphism cards */
        .glass-card {
            background: rgba(31, 41, 55, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(75, 85, 99, 0.2);
        }
        
        .glass-card:hover {
            background: rgba(31, 41, 55, 0.9);
            border-color: rgba(75, 85, 99, 0.3);
        }
        
        /* Gradient text effect */
        .gradient-text {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Sidebar toggle functionality - SIMPLIFIED */
        .nav-sidebar {
            transition: width 0.3s ease;
            overflow: visible;
        }

        /* Collapsed state */
        .nav-sidebar.collapsed {
            width: 80px !important;
            min-width: 80px !important;
            max-width: 80px !important;
            flex-basis: 80px !important;
        }

        /* Expanded state - restore original width */
        .nav-sidebar:not(.collapsed) {
            width: 288px !important; /* md:w-72 equivalent */
            min-width: 288px !important;
            max-width: 288px !important;
            flex-basis: 288px !important;
        }

        /* Mobile responsive - smaller width */
        @media (max-width: 767px) {
            .nav-sidebar:not(.collapsed) {
                width: 256px !important; /* w-64 equivalent */
                min-width: 256px !important;
                max-width: 256px !important;
                flex-basis: 256px !important;
            }
        }

        /* Hide text elements in collapsed state */
        .nav-sidebar.collapsed .sidebar-text,
        .nav-sidebar.collapsed .nav-item > span,
        .nav-sidebar.collapsed .nav-item > kbd,
        .nav-sidebar.collapsed h3 {
            display: none;
        }

        /* Hide support dropdown and chevron in collapsed state */
        .nav-sidebar.collapsed #support-dropdown,
        .nav-sidebar.collapsed #support-chevron {
            display: none;
        }

        /* Hide text in support button specifically */
        .nav-sidebar.collapsed #support-toggle span,
        .nav-sidebar.collapsed #support-toggle .flex:first-child span {
            display: none;
        }


        /* Center nav items in collapsed state */
        .nav-sidebar.collapsed .nav-item {
            justify-content: center !important;
            padding: 0.75rem !important;
        }

        /* Fix support button in collapsed state - only center the heart icon */
        .nav-sidebar.collapsed #support-toggle {
            justify-content: center !important;
            padding: 0.75rem !important;
        }

        /* Ensure all nav icons are visible and properly sized in collapsed state */
        .nav-sidebar.collapsed .nav-icon {
            flex-shrink: 0;
            width: 1.25rem;
            height: 1.25rem;
        }

        /* Hide contribute button in collapsed mode */
        .nav-sidebar.collapsed a[href*="github"] {
            display: none !important;
        }

        /* Hide external link icon in collapsed state */
        .nav-sidebar.collapsed .nav-item i[data-lucide="external-link"] {
            display: none;
        }

        /* Main content area flex behavior */
        .main-area {
            flex: 1 1 0%;
            min-width: 0;
            overflow-x: auto;
        }

        /* Enhanced toggle button */
        .sidebar-toggle-btn {
            position: absolute;
            top: 50%;
            right: -28px;
            transform: translateY(-50%);
            width: 24px;
            height: 40px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border: 2px solid #1e3a8a;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            box-shadow: 2px 0 12px rgba(0, 0, 0, 0.4);
        }

        .sidebar-toggle-btn:hover {
            background: linear-gradient(135deg, #2563eb, #1e40af);
            transform: translateY(-50%) translateX(3px);
            box-shadow: 5px 0 20px rgba(59, 130, 246, 0.4);
        }

        /* Ensure toggle button doesn't interfere with main content */
        @media (min-width: 768px) {
            .main-area {
                position: relative;
                z-index: 1;
            }
            
            .sidebar-toggle-btn {
                z-index: 999;
            }
        }

        .sidebar-toggle-btn i {
            color: white;
            transition: transform 0.3s ease;
        }

        .nav-sidebar.collapsed .sidebar-toggle-btn i {
            transform: rotate(180deg);
        }

        .nav-sidebar.collapsed .sidebar-toggle-btn {
            right: -28px;
        }

        /* Ensure toggle is always accessible */
        @media (max-width: 767px) {
            .sidebar-toggle-btn {
                display: none;
            }
        }

        /* Active state feedback */
        .sidebar-toggle-btn:active {
            transform: translateY(-50%) translateX(1px) scale(0.95);
        }

        /* Accessibility */
        .sidebar-toggle-btn:focus {
            outline: 2px solid #60a5fa;
            outline-offset: 2px;
        }

        /* Support dropdown styling */
        #support-dropdown {
            transition: all 0.3s ease;
        }

        #support-dropdown a:hover {
            background: rgba(102, 126, 234, 0.1);
            border-left-color: rgba(102, 126, 234, 0.6);
        }

        /* Ensure support section works well in mobile */
        @media (max-width: 767px) {
            #support-dropdown {
                margin-left: 0.5rem;
            }
        }

        /* ================================ */
        /* ENHANCED NOTIFICATION STYLING */
        /* ================================ */
        
        /* Success messages - enhanced green styling */
        .notyf__toast--success {
            background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
            border: 1px solid rgba(34, 197, 94, 0.3);
            box-shadow: 0 8px 32px rgba(34, 197, 94, 0.25), 
                        0 4px 16px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(12px);
        }

        .notyf__toast--success .notyf__wrapper {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(8px);
        }

        .notyf__toast--success .notyf__message {
            color: #ffffff;
            font-weight: 500;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .notyf__toast--success .notyf__icon--success {
            background: rgba(255, 255, 255, 0.9);
            color: #16a34a;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        /* Error messages - enhanced red styling with high contrast */
        .notyf__toast--error {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            border: 1px solid rgba(239, 68, 68, 0.4);
            box-shadow: 0 8px 32px rgba(239, 68, 68, 0.3), 
                        0 4px 16px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(12px);
        }

        .notyf__toast--error .notyf__wrapper {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(8px);
        }

        .notyf__toast--error .notyf__message {
            color: #ffffff;
            font-weight: 600;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
            font-size: 14px;
        }

        .notyf__toast--error .notyf__icon--error {
            background: rgba(255, 255, 255, 0.95);
            color: #dc2626;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        /* General toast enhancements */
        .notyf__toast {
            border-radius: 12px;
            min-width: 320px;
            max-width: 420px;
            backdrop-filter: blur(16px);
            position: relative;
            overflow: hidden;
        }

        .notyf__toast::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        }

        .notyf__wrapper {
            border-radius: 11px;
            padding: 16px 20px;
            position: relative;
        }

        .notyf__message {
            line-height: 1.4;
            font-size: 14px;
            margin: 0;
        }

        .notyf__icon {
            margin-right: 16px;
            flex-shrink: 0;
        }

        .notyf__icon--success,
        .notyf__icon--error {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        /* Dismiss button styling */
        .notyf__dismiss-btn {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .notyf__dismiss-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: scale(1.05);
        }

        /* Animation improvements */
        .notyf__toast {
            animation: slideInRight 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .notyf__toast--disappear {
            animation: slideOutRight 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideOutRight {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100%);
            }
        }

        /* Mobile responsive adjustments */
        @media (max-width: 480px) {
            .notyf__toast {
                min-width: calc(100vw - 40px);
                max-width: calc(100vw - 40px);
                border-radius: 8px;
            }
            
            .notyf__wrapper {
                padding: 14px 16px;
            }
            
            .notyf__message {
                font-size: 13px;
            }
        }

    </style>
</head>

<body class="bg-gray-900 text-white min-h-screen">
    <!-- Mobile Navigation Toggle -->
    <button id="mobile-nav-toggle" class="md:hidden fixed top-4 left-4 z-50 bg-gray-800 p-2 rounded-lg">
        <i data-lucide="menu" class="w-6 h-6"></i>
    </button>

    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar Navigation -->
        <nav id="nav-sidebar" class="nav-sidebar w-64 md:w-72 fixed md:relative h-full z-40 flex flex-col">
            <!-- Header -->
            <div class="p-6 border-b border-gray-700/50 relative bg-gradient-to-r from-slate-900/50 to-slate-800/30">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center flex-shrink-0 border border-blue-400/30">
                        <i data-lucide="trending-up" class="w-6 h-6 text-white"></i>
                    </div>
                    <div class="sidebar-text">
                        <h1 class="text-lg font-bold gradient-text">SkinStatz</h1>
                        <p class="text-xs text-gray-400">Your Skin Arsenal, Fully Tracked.</p>
                    </div>
                </div>
                <button id="sidebar-toggle" class="sidebar-toggle-btn">
                    <i data-lucide="panel-left-close" class="w-4 h-4"></i>
                </button>
            </div>
            
            <!-- Navigation Items -->
            <div class="flex-1 overflow-y-auto py-4">
                <ul class="space-y-1 px-3">
                    <li>
                        <a href="#/dashboard" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-300 hover:text-white" data-page="dashboard">
                            <i data-lucide="layout-dashboard" class="w-5 h-5 nav-icon"></i>
                            <span>Dashboard</span>
                            <kbd class="hidden md:inline-block ml-auto text-xs bg-gray-700 px-2 py-1 rounded">‚åò+1</kbd>
                        </a>
                    </li>
                    <li>
                        <a href="#/trading" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-300 hover:text-white" data-page="trading">
                            <i data-lucide="trending-up" class="w-5 h-5 nav-icon"></i>
                            <span>Trading</span>
                            <kbd class="hidden md:inline-block ml-auto text-xs bg-gray-700 px-2 py-1 rounded">‚åò+2</kbd>
                        </a>
                    </li>
                    <li>
                        <a href="#/investments" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-300 hover:text-white" data-page="investments">
                            <i data-lucide="briefcase" class="w-5 h-5 nav-icon"></i>
                            <span>Investments</span>
                            <kbd class="hidden md:inline-block ml-auto text-xs bg-gray-700 px-2 py-1 rounded">‚åò+3</kbd>
                        </a>
                    </li>
                    <li>
                        <a href="#/cases" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-300 hover:text-white" data-page="cases">
                            <i data-lucide="package" class="w-5 h-5 nav-icon"></i>
                            <span>Weekly Drops</span>
                            <kbd class="hidden md:inline-block ml-auto text-xs bg-gray-700 px-2 py-1 rounded">‚åò+4</kbd>
                        </a>
                    </li>
                    <li>
                        <a href="#/inventory" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-300 hover:text-white" data-page="inventory">
                            <i data-lucide="package-2" class="w-5 h-5 nav-icon"></i>
                            <span>Inventory</span>
                            <kbd class="hidden md:inline-block ml-auto text-xs bg-gray-700 px-2 py-1 rounded">‚åò+5</kbd>
                        </a>
                    </li>
                    <li>
                        <a href="#/skin-explorer" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-300 hover:text-white" data-page="skin-explorer">
                            <i data-lucide="search" class="w-5 h-5 nav-icon"></i>
                            <span>Skin Explorer</span>
                            <kbd class="hidden md:inline-block ml-auto text-xs bg-gray-700 px-2 py-1 rounded">‚åò+6</kbd>
                        </a>
                    </li>
                </ul>
                
                <!-- Section Divider -->
                <div class="border-t border-gray-700/30 my-4 mx-6 relative">
                    <div class="absolute inset-0 bg-gradient-to-r from-transparent via-blue-500/20 to-transparent h-px"></div>
                </div>
                
                <!-- Quick Actions -->
                <div class="px-3">
                    <h3 class="text-xs font-semibold text-blue-300/80 uppercase tracking-wider px-4 mb-3 flex items-center">
                        <i data-lucide="zap" class="w-3 h-3 mr-2"></i>
                        Quick Actions
                    </h3>
                    <ul class="space-y-1">
                        <li>
                            <button id="quick-add-trade" class="nav-item w-full flex items-center space-x-3 px-4 py-2 rounded-lg text-gray-300 hover:text-white text-left">
                                <i data-lucide="plus-circle" class="w-4 h-4 nav-icon"></i>
                                <span class="text-sm">Add Trade</span>
                            </button>
                        </li>
                        <li>
                            <button id="quick-export" class="nav-item w-full flex items-center space-x-3 px-4 py-2 rounded-lg text-gray-300 hover:text-white text-left">
                                <i data-lucide="download" class="w-4 h-4 nav-icon"></i>
                                <span class="text-sm">Export Data</span>
                            </button>
                        </li>
                        <li>
                            <button id="quick-import" class="nav-item w-full flex items-center space-x-3 px-4 py-2 rounded-lg text-gray-300 hover:text-white text-left">
                                <i data-lucide="upload" class="w-4 h-4 nav-icon"></i>
                                <span class="text-sm">Import Data</span>
                            </button>
                        </li>
                    </ul>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="p-4 border-t border-gray-700">
                <!-- User Section -->
                <ul class="space-y-1 mb-4">
                    <!-- Profile Section -->
                    <li>
                        <a href="#/profile" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-300 hover:text-white" data-page="profile">
                            <i data-lucide="user" class="w-5 h-5 nav-icon"></i>
                            <span>Profile</span>
                        </a>
                    </li>
                </ul>
                
                <!-- Community Section Divider -->
                <div class="border-t border-gray-700/30 mb-4 relative">
                    <div class="absolute inset-0 bg-gradient-to-r from-transparent via-blue-500/10 to-transparent h-px"></div>
                </div>
                
                <!-- Community Section -->
                <ul class="space-y-1">
                    <!-- Support Section -->
                    <li>
                        <button id="support-toggle" class="nav-item w-full flex items-center justify-between px-4 py-3 rounded-lg text-gray-300 hover:text-white text-left">
                            <div class="flex items-center space-x-3">
                                <i data-lucide="heart" class="w-5 h-5 nav-icon"></i>
                                <span>Support</span>
                            </div>
                            <i data-lucide="chevron-down" class="w-4 h-4 transition-transform duration-200" id="support-chevron"></i>
                        </button>
                        
                        <!-- Support Options Dropdown -->
                        <div id="support-dropdown" class="hidden mt-2 ml-4 space-y-1">
                            <a href="https://buymeacoffee.com/sadat_41" target="_blank" rel="noopener noreferrer" class="nav-item flex items-center space-x-3 px-4 py-2 rounded-lg text-gray-400 hover:text-white text-sm">
                                <i data-lucide="coffee" class="w-4 h-4 nav-icon"></i>
                                <span>Buy Me a Coffee</span>
                                <i data-lucide="external-link" class="w-3 h-3 ml-auto opacity-60"></i>
                            </a>
                            <a href="https://steamcommunity.com/tradeoffer/new/?partner=194904016&token=hHHzu1LH" target="_blank" rel="noopener noreferrer" class="nav-item flex items-center space-x-3 px-4 py-2 rounded-lg text-gray-400 hover:text-white text-sm">
                                <i data-lucide="gamepad-2" class="w-4 h-4 nav-icon"></i>
                                <span>Steam</span>
                                <i data-lucide="external-link" class="w-3 h-3 ml-auto opacity-60"></i>
                            </a>
                        </div>
                    </li>
                    
                    <!-- Contribute Section -->
                    <li>
                        <a href="https://github.com/Sadat41/SkinStatz" target="_blank" rel="noopener noreferrer" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-300 hover:text-white">
                            <i data-lucide="code" class="w-5 h-5 nav-icon"></i>
                            <span>Contribute</span>
                            <i data-lucide="external-link" class="w-3 h-3 ml-auto opacity-60"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </nav>
        
        <!-- Main Content Area -->
        <main class="main-area flex-1 flex flex-col min-h-screen">
            
            <!-- Page Content -->
            <div id="main-content" class="flex-1 p-6 overflow-y-auto">
                <!-- Content will be dynamically loaded here -->
                <div id="initial-loading" class="text-center py-20">
                    <div class="animate-pulse">
                        <div class="w-16 h-16 bg-blue-500 rounded-full mx-auto mb-4 flex items-center justify-center">
                            <i data-lucide="loader" class="w-8 h-8 text-white animate-spin"></i>
                        </div>
                        <p class="text-gray-400">Loading SkinStatz...</p>
                        <div class="mt-4">
                            <div class="text-xs text-gray-500">If this takes too long, check browser console for errors</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Mobile Overlay -->
    <div id="mobile-overlay" class="md:hidden fixed inset-0 bg-black bg-opacity-50 z-30 hidden"></div>
    
    <!-- Load modular system components with proper dependency handling -->
    <script>
        // Enhanced dependency loading system
        console.log('üöÄ Starting SkinStatz initialization...')
        
        // Wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üìÑ DOM loaded, starting module initialization...')
            
            // Set a global timeout to prevent infinite loading
            const globalTimeout = setTimeout(() => {
                console.error('‚ùå Global initialization timeout - forcing fallback interface')
                showErrorInterface(new Error('Initialization timed out after 10 seconds'))
            }, 10000) // 10 second global timeout
            
            try {
                // Load modules in sequence with timeout protection
                console.log('üì¶ Loading store module...')
                await Promise.race([
                    import('./src/store.js'),
                    new Promise((_, reject) => setTimeout(() => reject(new Error('Store module timeout')), 3000))
                ])
                
                // Wait a bit for store to be available globally
                await new Promise(resolve => setTimeout(resolve, 200))
                
                if (!window.useAppStore) {
                    throw new Error('Store module failed to export useAppStore globally')
                }
                console.log('‚úÖ Store module loaded successfully')
                
                console.log('üì¶ Loading router module...')
                await Promise.race([
                    import('./src/router.js'),
                    new Promise((_, reject) => setTimeout(() => reject(new Error('Router module timeout')), 3000))
                ])
                
                // Wait a bit for router to be available globally
                await new Promise(resolve => setTimeout(resolve, 200))
                
                if (!window.CS2Router) {
                    throw new Error('Router module failed to export CS2Router globally')
                }
                console.log('‚úÖ Router module loaded successfully')
                
                console.log('üì¶ Loading main application...')
                await Promise.race([
                    import('./src/main.js'),
                    new Promise((_, reject) => setTimeout(() => reject(new Error('Main application timeout')), 5000))
                ])
                console.log('‚úÖ Main application loaded successfully')
                
                // Clear the global timeout since we succeeded
                clearTimeout(globalTimeout)
                console.log('üéâ All modules loaded successfully!')
                
            } catch (error) {
                clearTimeout(globalTimeout)
                console.error('‚ùå Module loading failed:', error)
                showErrorInterface(error)
            }
        })
        
        // Error interface fallback
        function showErrorInterface(error) {
            const mainContent = document.getElementById('main-content')
            if (mainContent) {
                mainContent.innerHTML = `
                    <div class="text-center py-20">
                        <div class="text-red-400 text-6xl mb-4">‚ö†Ô∏è</div>
                        <h1 class="text-3xl font-bold text-red-400 mb-4">Module Loading Error</h1>
                        <p class="text-gray-400 mb-4">${error.message}</p>
                        <div class="glass-card rounded-xl p-6 max-w-md mx-auto">
                            <h3 class="text-lg font-semibold text-white mb-3">Troubleshooting:</h3>
                            <ul class="text-left text-gray-300 space-y-2 mb-4">
                                <li>‚Ä¢ Check browser console for detailed errors</li>
                                <li>‚Ä¢ Verify all files are properly served</li>
                                <li>‚Ä¢ Try refreshing the page</li>
                                <li>‚Ä¢ Use the original tracker as fallback</li>
                            </ul>
                            <div class="space-y-2">
                                <button onclick="location.reload()" 
                                        class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                                    Reload Page
                                </button>
                                <button onclick="window.location.href='tracker.html'" 
                                        class="w-full bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg">
                                    Use Original Tracker
                                </button>
                            </div>
                        </div>
                    </div>
                `
            }
        }
        
        // Mobile navigation toggle
        document.addEventListener('DOMContentLoaded', () => {
            const mobileToggle = document.getElementById('mobile-nav-toggle')
            const overlay = document.getElementById('mobile-overlay')
            
            if (mobileToggle) {
                mobileToggle.addEventListener('click', () => {
                    const sidebar = document.getElementById('nav-sidebar')
                    
                    sidebar.classList.toggle('open')
                    overlay.classList.toggle('hidden')
                })
            }
            
            // Close mobile nav when overlay is clicked
            if (overlay) {
                overlay.addEventListener('click', () => {
                    const sidebar = document.getElementById('nav-sidebar')
                    
                    sidebar.classList.remove('open')
                    overlay.classList.add('hidden')
                })
            }
            
            // Sidebar toggle functionality
            const sidebarToggle = document.getElementById('sidebar-toggle')
            const sidebar = document.getElementById('nav-sidebar')
            
            if (sidebarToggle && sidebar) {
                sidebarToggle.addEventListener('click', () => {
                    console.log('Toggle clicked')
                    sidebar.classList.toggle('collapsed')
                    
                    // Store the collapsed state in localStorage
                    const isCollapsed = sidebar.classList.contains('collapsed')
                    localStorage.setItem('sidebarCollapsed', isCollapsed)
                    console.log('Sidebar collapsed:', isCollapsed)
                })
                
                // Restore sidebar state from localStorage
                const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true'
                console.log('Restored state:', isCollapsed)
                if (isCollapsed) {
                    sidebar.classList.add('collapsed')
                }
            }
            
            // Support dropdown functionality
            const supportToggle = document.getElementById('support-toggle')
            const supportDropdown = document.getElementById('support-dropdown')
            const supportChevron = document.getElementById('support-chevron')
            
            if (supportToggle && supportDropdown && supportChevron) {
                // Force initial state to be closed
                supportDropdown.classList.add('hidden')
                supportChevron.style.transform = 'rotate(0deg)'
                
                supportToggle.addEventListener('click', () => {
                    const isHidden = supportDropdown.classList.contains('hidden')
                    
                    if (isHidden) {
                        supportDropdown.classList.remove('hidden')
                        supportChevron.style.transform = 'rotate(180deg)'
                        localStorage.setItem('supportDropdownOpen', 'true')
                    } else {
                        supportDropdown.classList.add('hidden')
                        supportChevron.style.transform = 'rotate(0deg)'
                        localStorage.setItem('supportDropdownOpen', 'false')
                    }
                })
                
                // Only restore state if explicitly set to true
                setTimeout(() => {
                    const storedState = localStorage.getItem('supportDropdownOpen')
                    if (storedState === 'true') {
                        supportDropdown.classList.remove('hidden')
                        supportChevron.style.transform = 'rotate(180deg)'
                    }
                }, 100)
            }
            
            // Initialize Lucide icons
            if (typeof lucide !== 'undefined') {
                lucide.createIcons()
            }
            
            // Test navigation click detection
            document.addEventListener('click', (e) => {
                if (e.target.closest('a[href^="#/"]')) {
                    const link = e.target.closest('a[href^="#/"]')
                    console.log('üîç Navigation link clicked:', link.href)
                }
            })
        })
        
        // Emergency fallback - if nothing loads after 5 seconds, show basic content
        setTimeout(() => {
            const mainContent = document.getElementById('main-content')
            const initialLoading = document.getElementById('initial-loading')
            
            // Only show emergency fallback if still showing loading screen
            if (mainContent && initialLoading && initialLoading.style.display !== 'none') {
                console.warn('üö® Emergency fallback activated - modules failed to load in time')
                mainContent.innerHTML = `
                    <div class="text-center py-20">
                        <h1 class="text-3xl font-bold gradient-text mb-4">SkinStatz Dashboard</h1>
                        <p class="text-gray-400 mb-8">Emergency Mode - Basic functionality available</p>
                        <div class="glass-card rounded-xl p-6 max-w-md mx-auto">
                            <h3 class="text-lg font-semibold text-white mb-3">Quick Actions:</h3>
                            <div class="space-y-3">
                                <button onclick="window.location.href='tracker.html'" 
                                        class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                                    Use Original Tracker
                                </button>
                                <button onclick="location.reload()" 
                                        class="w-full bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg">
                                    Try Again
                                </button>
                                <button onclick="console.clear(); location.reload()" 
                                        class="w-full bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg">
                                    Clear Console & Reload
                                </button>
                            </div>
                        </div>
                        <div class="mt-6 text-xs text-gray-500">
                            Check browser console (F12) for detailed error information
                        </div>
                    </div>
                `
                
                // Initialize icons for the emergency interface
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons()
                }
            }
        }, 5000) // 5 second emergency timeout
        
        console.log('üöÄ SkinStatz - Enhanced Module Loading System')
        
        // Debug function to clear dropdown state - remove this after testing
        // Uncomment the next line if you want to reset the dropdown state
        // localStorage.removeItem('supportDropdownOpen')
    </script>
</body>
</html>